<!doctype html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Bot Ayarları</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        height: 100vh;
        height: 100dvh; /* Dynamic viewport height for mobile */
        overflow-x: hidden;
        position: fixed;
        width: 100%;
        background: #111827;
        /* Safe area support */
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
      }

      /* Telegram specific styles */
      body {
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: none;
        user-select: none;
        -webkit-user-select: none;
        -webkit-touch-callout: none;
      }

      /* Hide scrollbars but allow scrolling */
      ::-webkit-scrollbar {
        display: none;
      }

      /* Ensure full height on all browsers */
      .app-container {
        min-height: 100vh;
        min-height: 100dvh;
        height: 100vh;
        height: 100dvh;
        /* Account for safe areas */
        min-height: calc(
          100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom)
        );
        min-height: calc(
          100dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom)
        );
      }

      /* Header safe area styling */
      .header-safe {
        padding-top: max(1rem, env(safe-area-inset-top));
        margin-top: calc(-1 * env(safe-area-inset-top));
        background: #111827;
      }

      /* Content area with safe spacing */
      .content-safe {
        padding-left: max(1rem, env(safe-area-inset-left));
        padding-right: max(1rem, env(safe-area-inset-right));
        padding-bottom: max(1rem, env(safe-area-inset-bottom));
      }
    </style>
  </head>
  <body class="bg-gray-900 app-container">
    <script>
      // Telegram Web App initialization
      if (window.Telegram && window.Telegram.WebApp) {
        const tg = window.Telegram.WebApp;

        // Request fullscreen mode
        if (tg.requestFullscreen) {
          tg.requestFullscreen();
        }

        // Expand the app to fullscreen
        tg.expand();

        // Set header color to match app theme
        tg.setHeaderColor("#111827"); // gray-900

        // Remove the main button if it exists
        tg.MainButton.hide();

        // Show the app as ready
        tg.ready();

        // Alternative method for fullscreen
        if (tg.web_app_request_fullscreen) {
          tg.web_app_request_fullscreen();
        }

        // Force fullscreen viewport with multiple attempts
        setTimeout(() => {
          tg.expand();
          if (tg.requestFullscreen) {
            tg.requestFullscreen();
          }
        }, 100);

        setTimeout(() => {
          if (tg.web_app_request_fullscreen) {
            tg.web_app_request_fullscreen();
          }
        }, 200);
      }

      // Ensure fullscreen on load
      window.addEventListener("load", () => {
        // Set viewport height dynamically
        const setVH = () => {
          let vh = window.innerHeight * 0.01;
          document.documentElement.style.setProperty("--vh", `${vh}px`);
        };

        setVH();
        window.addEventListener("resize", setVH);
        window.addEventListener("orientationchange", setVH);
      });
    </script>
    <script>
      // API'den ayarları çek ve formu doldur
      async function loadSettings() {
        try {
          const response = await fetch(
            "https://tracker.vinx.online/monitor/settings",
          );
          const data = await response.json();

          if (data.success && data.settings) {
            const settings = data.settings;

            // Form alanlarını doldur
            document.getElementById("positionThreshold").value =
              settings.positionValueThreshold || "";
            document.getElementById("imThreshold").value =
              settings.imThreshold || "";
            document.getElementById("interval").value =
              settings.intervalTime || "";

            // Status indicator güncelle
            updateStatusIndicator(settings.isRunning);

            // Uptime güncelle
            updateUptime(settings.uptime);
          }
        } catch (error) {
          console.error("Ayarlar yüklenirken hata:", error);
        }
      }

      // Status indicator güncelleme fonksiyonu
      function updateStatusIndicator(isRunning) {
        const indicator = document.getElementById("statusIndicator");
        const statusText = document.getElementById("statusText");

        if (isRunning) {
          indicator.className =
            "w-3 h-3 rounded-full bg-green-500 transition-all duration-300 animate-pulse";
          statusText.textContent = "Aktif";
          statusText.className = "text-xs text-green-400";
        } else {
          indicator.className =
            "w-3 h-3 rounded-full bg-red-500 transition-all duration-300 animate-pulse";
          statusText.textContent = "Pasif";
          statusText.className = "text-xs text-red-400";
        }
      }

      // Uptime formatla ve göster
      function updateUptime(uptimeMinutes) {
        const uptimeElement = document.getElementById("uptimeText");

        if (!uptimeMinutes || uptimeMinutes === 0) {
          uptimeElement.textContent = "00:00:00:00";
          return;
        }

        const totalSeconds = uptimeMinutes * 60;
        const days = Math.floor(totalSeconds / (24 * 60 * 60));
        const hours = Math.floor((totalSeconds % (24 * 60 * 60)) / (60 * 60));
        const minutes = Math.floor((totalSeconds % (60 * 60)) / 60);
        const seconds = totalSeconds % 60;

        const formattedUptime = `${String(days).padStart(2, "0")}:${String(hours).padStart(2, "0")}:${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}`;
        uptimeElement.textContent = formattedUptime;
      }

      // Ayarları kaydet
      async function saveSettings(event) {
        event.preventDefault();

        const button = document.getElementById("saveButton");
        const originalText = button.textContent;

        try {
          // Button durumunu güncelle
          button.textContent = "Kaydediliyor...";
          button.disabled = true;
          button.classList.add("opacity-50");

          // Form verilerini al
          const positionThreshold =
            document.getElementById("positionThreshold").value;
          const imThreshold = document.getElementById("imThreshold").value;
          const interval = document.getElementById("interval").value;

          // API'ye POST isteği gönder
          const response = await fetch(
            "https://tracker.vinx.online/monitor/settings",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                imThreshold: parseFloat(imThreshold) || 0,
                positionValueThreshold: parseFloat(positionThreshold) || 0,
                intervalTime: parseInt(interval) || 0,
              }),
            },
          );

          const data = await response.json();

          if (response.ok && data.success) {
            // Başarılı kayıt
            button.textContent = "Kaydedildi!";
            button.classList.remove("bg-blue-600", "hover:bg-blue-700");
            button.classList.add("bg-green-600");

            // 2 saniye sonra normal haline döndür
            setTimeout(() => {
              button.textContent = originalText;
              button.classList.remove("bg-green-600");
              button.classList.add("bg-blue-600", "hover:bg-blue-700");
              button.disabled = false;
              button.classList.remove("opacity-50");

              // Ayarları yeniden yükle
              loadSettings();
            }, 2000);
          } else {
            throw new Error(data.message || "Kayıt başarısız");
          }
        } catch (error) {
          console.error("Ayarlar kaydedilirken hata:", error);

          // Hata durumu
          button.textContent = "Hata!";
          button.classList.remove("bg-blue-600", "hover:bg-blue-700");
          button.classList.add("bg-red-600");

          // 2 saniye sonra normal haline döndür
          setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove("bg-red-600");
            button.classList.add("bg-blue-600", "hover:bg-blue-700");
            button.disabled = false;
            button.classList.remove("opacity-50");
          }, 2000);
        }
      }

      // Sayfa yüklendiğinde ayarları getir
      document.addEventListener("DOMContentLoaded", () => {
        loadSettings();

        // Form submit event listener ekle (form yoksa atla, diğer listener'lar çalışsın)
        document
          .querySelector("form")
          ?.addEventListener("submit", saveSettings);

        // Hesap işlemleri buton event listeners
        addAccountButtonListeners();
      });

      // Buton loader: özel SVG (gradient id her kullanımda benzersiz olmalı)
      function getButtonLoaderSvg() {
        const id =
          "loader-" + Date.now() + "-" + Math.random().toString(36).slice(2);
        return (
          '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" class="w-full h-full"><radialGradient id="' +
          id +
          '" cx=".66" fx=".66" cy=".3125" fy=".3125" gradientTransform="scale(1.5)"><stop offset="0" stop-color="#ffffff"></stop><stop offset=".3" stop-color="#ffffff" stop-opacity=".9"></stop><stop offset=".6" stop-color="#ffffff" stop-opacity=".6"></stop><stop offset=".8" stop-color="#ffffff" stop-opacity=".3"></stop><stop offset="1" stop-color="#ffffff" stop-opacity="0"></stop></radialGradient><circle transform-origin="center" fill="none" stroke="url(#' +
          id +
          ')" stroke-width="26" stroke-linecap="round" stroke-dasharray="200 1000" stroke-dashoffset="0" cx="100" cy="100" r="70"><animateTransform type="rotate" attributeName="transform" calcMode="spline" dur="2" values="360;0" keyTimes="0;1" keySplines="0 0 1 1" repeatCount="indefinite"></animateTransform></circle><circle transform-origin="center" fill="none" opacity=".2" stroke="#ffffff" stroke-width="26" stroke-linecap="round" cx="100" cy="100" r="70"></circle></svg>'
        );
      }
      function escapeHtml(s) {
        const div = document.createElement("div");
        div.textContent = s;
        return div.innerHTML;
      }

      function showButtonLoader(button, show) {
        if (!button) return;
        const arrow = button.querySelector("svg:last-child");
        if (show) {
          if (!arrow) return;
          const wrap = document.createElement("div");
          wrap.className = "w-5 h-5 flex-shrink-0";
          wrap.setAttribute("data-button-loader", "true");
          wrap.innerHTML = getButtonLoaderSvg();
          button._loaderOriginalArrow = arrow.cloneNode(true);
          arrow.replaceWith(wrap);
        } else {
          const wrap = button.querySelector("[data-button-loader]");
          const original = button._loaderOriginalArrow;
          if (wrap && original) wrap.replaceWith(original);
          delete button._loaderOriginalArrow;
        }
      }

      // Hesap işlemleri buton listeners (her buton yoksa sadece o atlanır)
      function addAccountButtonListeners() {
        document
          .querySelector('[data-action="subaccount-summary"]')
          ?.addEventListener("click", async () => {
            await fetchAndShowSubaccountSummary();
          });
        document
          .querySelector('[data-action="subaccount-stats"]')
          ?.addEventListener("click", async () => {
            await fetchAndShowSubaccountStats();
          });
        document
          .querySelector('[data-action="main-account-summary"]')
          ?.addEventListener("click", async () => {
            await fetchAndShowMainAccountSummary();
          });
        document
          .querySelector('[data-action="main-account-earning"]')
          ?.addEventListener("click", async () => {
            await fetchAndShowMainAccountEarning();
          });
      }

      // Subaccount Summary API çağırıp modal göster
      async function fetchAndShowSubaccountSummary() {
        const button = document.querySelector(
          '[data-action="subaccount-summary"]',
        );
        try {
          showButtonLoader(button, true);
          const response = await fetch(
            "https://tracker.vinx.online/api/sub/summary",
          );
          const data = await response.json();

          if (data.success) {
            showSubaccountModal(data.data);
          } else {
            alert("Veri alınamadı");
          }
        } catch (error) {
          console.error("API hatası:", error);
          alert("Bir hata oluştu");
        } finally {
          showButtonLoader(button, false);
        }
      }

      // Subaccount Stats (summary history) API - en fazla 10 gün aralık
      const SUB_SUMMARY_HISTORY_API =
        "https://tracker.vinx.online/api/sub/summary/history";
      const MAX_RANGE_DAYS = 10;

      async function fetchAndShowSubaccountStats(from, to) {
        const button = document.querySelector(
          '[data-action="subaccount-stats"]',
        );
        const toDate = to ? (typeof to === "string" ? new Date(to) : to) : new Date();
        const fromDate = from
          ? (typeof from === "string" ? new Date(from) : from)
          : new Date(toDate.getTime() - MAX_RANGE_DAYS * 24 * 60 * 60 * 1000);
        const fromStr = fromDate.toISOString().slice(0, 10);
        const toStr = toDate.toISOString().slice(0, 10);
        const useRange = from && to;
        try {
          showButtonLoader(button, true);
          let url = SUB_SUMMARY_HISTORY_API;
          if (useRange) {
            url += "?from=" + encodeURIComponent(fromStr) + "&to=" + encodeURIComponent(toStr);
          }
          const response = await fetch(url);
          const data = await response.json();

          if (!response.ok) {
            if (response.status === 503) {
              alert(data.error || "Veritabanı servisi kullanılamıyor");
              return;
            }
            if (response.status === 400) {
              alert(data.error || "Geçersiz tarih aralığı");
              return;
            }
            alert(data.error || data.message || "Veri alınamadı");
            return;
          }

          if (data.success) {
            showSubaccountStatsModal(data.data || [], data.count, useRange ? fromDate : null, useRange ? toDate : null);
          } else {
            alert(data.error || "Veri alınamadı");
          }
        } catch (error) {
          console.error("API hatası:", error);
          alert("Bir hata oluştu");
        } finally {
          showButtonLoader(button, false);
        }
      }

      function showSubaccountStatsModal(snapshots, count, from, to) {
        const modal = createSubaccountStatsModal(snapshots, count, from, to);
        document.body.appendChild(modal);
        requestAnimationFrame(() => {
          modal.classList.remove("opacity-0");
          modal.querySelector(".modal-content").classList.remove("scale-95");
          modal.querySelector(".modal-content").classList.add("scale-100");
        });

        const getirBtn = modal.querySelector('[data-action="stats-fetch"]');
        const fromInput = modal.querySelector('#stats-from');
        const toInput = modal.querySelector('#stats-to');
        if (getirBtn && fromInput && toInput) {
          getirBtn.addEventListener("click", async () => {
            const fromVal = fromInput.value;
            const toVal = toInput.value;
            if (!fromVal || !toVal) {
              alert("Lütfen başlangıç ve bitiş tarihi seçin.");
              return;
            }
            const fromDate = new Date(fromVal);
            const toDate = new Date(toVal);
            if (toDate.getTime() - fromDate.getTime() > MAX_RANGE_DAYS * 24 * 60 * 60 * 1000) {
              alert("Aralık en fazla " + MAX_RANGE_DAYS + " gün olabilir.");
              return;
            }
            getirBtn.disabled = true;
            getirBtn.textContent = "Yükleniyor...";
            try {
              const response = await fetch(
                SUB_SUMMARY_HISTORY_API + "?from=" + encodeURIComponent(fromVal) + "&to=" + encodeURIComponent(toVal)
              );
              const data = await response.json();
              if (data.success) {
                const tbody = modal.querySelector(".stats-tbody");
                const thead = modal.querySelector(".stats-thead");
                if (tbody) tbody.innerHTML = renderStatsRows(data.data || []);
                if (thead) thead.innerHTML = renderStatsHeader();
                const countEl = modal.querySelector(".stats-count");
                if (countEl) countEl.textContent = (data.count ?? data.data?.length ?? 0) + " kayıt";
              } else {
                alert(data.error || "Veri alınamadı");
              }
            } catch (e) {
              alert("İstek başarısız.");
            } finally {
              getirBtn.disabled = false;
              getirBtn.textContent = "Verileri Getir";
            }
          });
        }
      }

      // Subaccount Stats kolonları: response { id, created_at, summary, usdtBalance }
      const STATS_COLUMNS = [
        { key: "created_at", label: "Tarih" },
        { key: "id", label: "#" },
        { key: "summary.totalEquity", label: "Total Equity" },
        { key: "summary.availableBalance", label: "Available Balance" },
        { key: "summary.marginBalance", label: "Margin Balance" },
        { key: "summary.unrealizedPnL", label: "Unrealized PnL" },
        { key: "summary.openPositionsCount", label: "Pozisyon" },
        { key: "summary.totalPositionValue", label: "Position Value" },
        { key: "usdtBalance.walletBalance", label: "Wallet" },
        { key: "usdtBalance.equity", label: "USDT Equity" },
      ];

      function getStatsValue(snap, key) {
        if (key === "id") return snap.id;
        if (key === "created_at") return snap.created_at;
        if (key.startsWith("summary.")) return snap.summary?.[key.slice(8)];
        if (key.startsWith("usdtBalance.")) return snap.usdtBalance?.[key.slice(12)];
        return "";
      }

      function formatStatsCell(key, value) {
        if (value == null || value === "") return "";
        if (key === "created_at" && value) {
          try {
            const d = new Date(value);
            return isNaN(d.getTime()) ? String(value) : d.toLocaleString("tr-TR", { dateStyle: "short", timeStyle: "medium" });
          } catch (_) { return String(value); }
        }
        if (typeof value === "number" && Number.isFinite(value)) {
          if (key.includes("Ratio") || key === "summary.mmEquityRatio" || key === "summary.imEquityRatio")
            return Number(value).toLocaleString("tr-TR", { minimumFractionDigits: 4, maximumFractionDigits: 4 });
          return Number(value).toLocaleString("tr-TR", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
        return String(value);
      }

      function renderStatsHeader() {
        const cells = STATS_COLUMNS.map(
          (c) => `<th class="text-left p-2 text-gray-300 text-xs whitespace-nowrap">${escapeHtml(c.label)}</th>`
        ).join("");
        return `<tr>${cells}</tr>`;
      }

      function renderStatsRows(snapshots) {
        if (!snapshots.length) return "<tr><td colspan=\"" + STATS_COLUMNS.length + "\" class=\"p-4 text-gray-400 text-center\">Kayıt yok</td></tr>";
        return snapshots
          .map(
            (snap) => {
              const cells = STATS_COLUMNS.map((col) => {
                const raw = getStatsValue(snap, col.key);
                const formatted = formatStatsCell(col.key, raw);
                const isPnl = col.key.includes("unrealizedPnL") || col.key.includes("unrealizedPnl");
                const num = typeof raw === "number" ? raw : parseFloat(raw);
                const pnlClass = isPnl && !isNaN(num) ? (num >= 0 ? "text-green-400" : "text-red-400") : "text-white";
                return `<td class="p-2 ${pnlClass} text-xs whitespace-nowrap">${escapeHtml(formatted)}</td>`;
              }).join("");
              return `<tr class="hover:bg-gray-600 border-b border-gray-600">${cells}</tr>`;
            }
          )
          .join("");
      }

      function createSubaccountStatsModal(snapshots, count, from, to) {
        const toDate = to ? (typeof to === "string" ? new Date(to) : to) : new Date();
        const fromDate = from
          ? (typeof from === "string" ? new Date(from) : from)
          : new Date(toDate.getTime() - MAX_RANGE_DAYS * 24 * 60 * 60 * 1000);
        const fromStr = fromDate.toISOString().slice(0, 10);
        const toStr = toDate.toISOString().slice(0, 10);

        const headerRow = renderStatsHeader();
        const bodyRows = renderStatsRows(snapshots);
        const displayCount = count ?? snapshots.length;

        const modal = document.createElement("div");
        modal.className =
          "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 opacity-0 transition-opacity duration-300";
        modal.style.paddingTop = "max(5rem, env(safe-area-inset-top))";
        modal.style.paddingBottom = "max(1rem, env(safe-area-inset-bottom))";
        modal.style.paddingLeft = "max(1rem, env(safe-area-inset-left))";
        modal.style.paddingRight = "max(1rem, env(safe-area-inset-right))";

        modal.innerHTML = `
          <div class="modal-content bg-gray-800 rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden transform scale-95 transition-transform duration-300 flex flex-col">
            <div class="bg-gray-900 p-4 border-b border-gray-700 flex items-center justify-between flex-shrink-0">
              <h2 class="text-lg font-semibold text-white">Subaccount Stats</h2>
              <button onclick="closeModal(this)" class="text-gray-400 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
            <div class="p-4 border-b border-gray-700 flex flex-wrap items-end gap-3 flex-shrink-0">
              <div>
                <label class="block text-xs text-gray-400 mb-1">Başlangıç (from)</label>
                <input type="date" id="stats-from" value="${fromStr}" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white text-sm"/>
              </div>
              <div>
                <label class="block text-xs text-gray-400 mb-1">Bitiş (to)</label>
                <input type="date" id="stats-to" value="${toStr}" class="px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white text-sm"/>
              </div>
              <button type="button" data-action="stats-fetch" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-white text-sm font-medium">
                Verileri Getir
              </button>
              <span class="text-gray-400 text-sm stats-count">${displayCount} kayıt</span>
              <span class="text-xs text-gray-500">(Aralık en fazla ${MAX_RANGE_DAYS} gün)</span>
            </div>
            <div class="overflow-auto flex-1 min-h-0">
              <table class="w-full text-sm">
                <thead class="bg-gray-700 sticky top-0 stats-thead">${headerRow}</thead>
                <tbody class="stats-tbody">${bodyRows}</tbody>
              </table>
            </div>
          </div>`;

        modal.addEventListener("click", (e) => {
          if (e.target === modal) closeModal(modal.querySelector("button"));
        });
        return modal;
      }

      // Position History = Kapatılmış pozisyonlar API çağırıp modal göster
      const POSITIONS_PAGE_SIZE = 20;
      const POSITIONS_CLOSED_API =
        "https://tracker.vinx.online/api/sub/positions/closed";
      async function fetchAndShowPositionHistory(page = 1) {
        const button = document.querySelector(
          '[data-action="position-history"]',
        );
        try {
          showButtonLoader(button, true);
          const url =
            POSITIONS_CLOSED_API +
            "?page=" +
            page +
            "&limit=" +
            POSITIONS_PAGE_SIZE;
          const response = await fetch(url);
          const data = await response.json();

          if (!response.ok) {
            if (response.status === 503) {
              alert(data.error || "Position tracker servisi henüz hazır değil");
              return;
            }
            if (response.status === 500) {
              alert(data.error || data.message || "Sunucu hatası");
              return;
            }
            alert(data.error || "Veri alınamadı");
            return;
          }

          if (data.success) {
            showPositionHistoryModal(data.data, page, POSITIONS_PAGE_SIZE);
          } else {
            alert(data.error || "Veri alınamadı");
          }
        } catch (error) {
          console.error("API hatası:", error);
          alert("Bir hata oluştu");
        } finally {
          showButtonLoader(button, false);
        }
      }

      // Main Account Summary API çağırıp modal göster
      async function fetchAndShowMainAccountSummary() {
        const button = document.querySelector(
          '[data-action="main-account-summary"]',
        );
        try {
          showButtonLoader(button, true);
          const response = await fetch(
            "https://tracker.vinx.online/api/main/balance",
          );
          const data = await response.json();

          if (data.success && data.data) {
            showMainAccountModal(data.data);
          } else {
            alert(data.error || data.message || "Veri alınamadı");
          }
        } catch (error) {
          console.error("API hatası:", error);
          alert("Bir hata oluştu");
        } finally {
          showButtonLoader(button, false);
        }
      }

      // Main Account Earning API çağırıp modal göster
      async function fetchAndShowMainAccountEarning() {
        const button = document.querySelector(
          '[data-action="main-account-earning"]',
        );
        try {
          showButtonLoader(button, true);
          const response = await fetch(
            "https://tracker.vinx.online/api/main/earnings",
          );
          const data = await response.json();

          if (data.success && data.data) {
            showMainAccountEarningModal(data.data);
          } else {
            alert(data.error || data.message || "Veri alınamadı");
          }
        } catch (error) {
          console.error("API hatası:", error);
          alert("Bir hata oluştu");
        } finally {
          showButtonLoader(button, false);
        }
      }

      // Subaccount modal göster
      function showSubaccountModal(data) {
        const modal = createSubaccountModal(data);
        document.body.appendChild(modal);

        // Modal'ı göster
        setTimeout(() => {
          modal.classList.remove("opacity-0");
          modal.querySelector(".modal-content").classList.remove("scale-95");
          modal.querySelector(".modal-content").classList.add("scale-100");
        }, 10);
      }

      // Position History modal göster
      function showPositionHistoryModal(data) {
        const modal = createPositionHistoryModal(data);
        document.body.appendChild(modal);

        setTimeout(() => {
          modal.classList.remove("opacity-0");
          modal.querySelector(".modal-content").classList.remove("scale-95");
          modal.querySelector(".modal-content").classList.add("scale-100");
        }, 10);
      }

      // Main Account modal göster
      function showMainAccountModal(data) {
        const modal = createMainAccountModal(data);
        document.body.appendChild(modal);

        // Modal'ı göster
        setTimeout(() => {
          modal.classList.remove("opacity-0");
          modal.querySelector(".modal-content").classList.remove("scale-95");
          modal.querySelector(".modal-content").classList.add("scale-100");
        }, 10);
      }

      // Main Account Earning modal göster
      function showMainAccountEarningModal(data) {
        const modal = createMainAccountEarningModal(data);
        document.body.appendChild(modal);

        // Modal'ı göster
        setTimeout(() => {
          modal.classList.remove("opacity-0");
          modal.querySelector(".modal-content").classList.remove("scale-95");
          modal.querySelector(".modal-content").classList.add("scale-100");
        }, 10);
      }

      // Subaccount modal oluştur
      function createSubaccountModal(data) {
        const summary = data.summary;
        const positions = data.positions;
        // tr-TR: ondalık ",", binlik "."
        const fmt = (n, minF = 2, maxF = 2) =>
          Number(n).toLocaleString("tr-TR", {
            minimumFractionDigits: minF,
            maximumFractionDigits: maxF,
          });

        const modal = document.createElement("div");
        modal.className =
          "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 opacity-0 transition-opacity duration-300";
        modal.style.paddingTop = "max(5rem, env(safe-area-inset-top))";
        modal.style.paddingBottom = "max(1rem, env(safe-area-inset-bottom))";
        modal.style.paddingLeft = "max(1rem, env(safe-area-inset-left))";
        modal.style.paddingRight = "max(1rem, env(safe-area-inset-right))";

        modal.innerHTML = `
                <div class="modal-content bg-gray-800 rounded-lg w-full h-full overflow-hidden transform scale-95 transition-transform duration-300">
                    <!-- Header -->
                    <div class="bg-gray-900 p-4 border-b border-gray-700 flex items-center justify-between">
                        <h2 class="text-lg font-semibold text-white">Subaccount Summary</h2>
                        <button onclick="closeModal(this)" class="text-gray-400 hover:text-white">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Content -->
                    <div class="overflow-y-auto h-full">
                        <!-- Summary Cards -->
                        <div class="p-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">Total Equity</p>
                                <p class="text-lg font-semibold text-white">$${summary.totalEquity.toLocaleString()}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">Available Balance</p>
                                <p class="text-lg font-semibold text-white">$${summary.availableBalance.toLocaleString()}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">Margin Balance</p>
                                <p class="text-lg font-semibold text-white">$${summary.marginBalance.toLocaleString()}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">Unrealized PnL</p>
                                <p class="text-lg font-semibold ${summary.unrealizedPnL >= 0 ? "text-green-400" : "text-red-400"}">
                                    $${summary.unrealizedPnL.toLocaleString()}
                                </p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">MM Equity Ratio</p>
                                <p class="text-lg font-semibold text-white">${summary.mmEquityRatio.toFixed(4)}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">IM Equity Ratio</p>
                                <p class="text-lg font-semibold text-white">${summary.imEquityRatio.toFixed(4)}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">Maintenance Margin</p>
                                <p class="text-lg font-semibold text-white">$${summary.maintenanceMargin.toLocaleString()}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">Initial Margin</p>
                                <p class="text-lg font-semibold text-white">$${summary.initialMargin.toLocaleString()}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">Open Positions</p>
                                <p class="text-lg font-semibold text-white">${summary.openPositionsCount}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">Total Position Value</p>
                                <p class="text-lg font-semibold text-white">$${summary.totalPositionValue.toLocaleString()}</p>
                            </div>
                        </div>

                        <!-- USDT Balance -->
                        <div class="px-4 pb-4">
                            <h3 class="text-sm font-medium text-gray-400 uppercase mb-2">USDT Balance</h3>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                    <div>
                                        <p class="text-gray-400">Wallet Balance</p>
                                        <p class="text-white font-medium">$${data.usdtBalance.walletBalance.toLocaleString()}</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-400">Available</p>
                                        <p class="text-white font-medium">$${data.usdtBalance.availableBalance.toLocaleString()}</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-400">Unrealized PnL</p>
                                        <p class="font-medium ${data.usdtBalance.unrealizedPnl >= 0 ? "text-green-400" : "text-red-400"}">
                                            $${data.usdtBalance.unrealizedPnl.toLocaleString()}
                                        </p>
                                    </div>
                                    <div>
                                        <p class="text-gray-400">Equity</p>
                                        <p class="text-white font-medium">$${data.usdtBalance.equity.toLocaleString()}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Positions -->
                        <div class="px-4 pb-4">
                            <h3 class="text-sm font-medium text-gray-400 uppercase mb-2">Open Positions (${positions.length})</h3>
                            ${(() => {
                              const positivePositions = positions.filter(
                                (p) => p.unrealizedPnl > 0,
                              );
                              const negativePositions = positions.filter(
                                (p) => p.unrealizedPnl < 0,
                              );
                              const totalPositivePnl = positivePositions.reduce(
                                (s, p) => s + p.unrealizedPnl,
                                0,
                              );
                              const totalNegativePnl = negativePositions.reduce(
                                (s, p) => s + p.unrealizedPnl,
                                0,
                              );
                              return `<p class="text-xs text-gray-400 mb-2">Anlık kâr <span class="text-green-400 font-medium">+${fmt(totalPositivePnl)}</span> USDT <span class="text-gray-500 font-medium">(${positivePositions.length} poz)</span> </br> Anlık zarar <span class="text-red-400 font-medium">${fmt(totalNegativePnl)}</span> USDT <span class="text-gray-500 font-medium">(${negativePositions.length} poz)</span></p>`;
                            })()}
                            <div class="bg-gray-700 rounded-lg overflow-hidden">
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-gray-600">
                                            <tr>
                                                <th class="text-left p-3 text-gray-300">Symbol</th>
                                                <th class="text-right p-3 text-gray-300"><span class="positions-sort cursor-pointer hover:text-white select-none inline-flex items-center gap-0.5" data-sort="pnl" title="PnL'e göre sırala">PnL <span class="positions-sort-arrow text-gray-500">↕</span></span> / <span class="positions-sort cursor-pointer hover:text-white select-none inline-flex items-center gap-0.5" data-sort="percentage" title="Yüzdeye göre sırala">% <span class="positions-sort-arrow text-gray-500">↕</span></span></th>
                                                <th class="text-right p-3 text-gray-300"><span class="positions-sort cursor-pointer hover:text-white select-none inline-flex items-center gap-0.5" data-sort="value" title="Value'a göre sırala">Value <span class="positions-sort-arrow text-gray-500">↕</span></span></th>
                                                <th class="text-right p-3 text-gray-300">Size/Price</th>
                                            </tr>
                                        </thead>
                                        <tbody class="positions-tbody divide-y divide-gray-600 font-mono">
                                            ${[...positions]
                                              .sort(
                                                (a, b) =>
                                                  b.unrealizedPnl -
                                                  a.unrealizedPnl,
                                              )
                                              .map(
                                                (pos) => `
                                                <tr class="hover:bg-gray-600">
                                                    <td class="p-1.5 text-white font-medium text-xs">${pos.symbol} </br>
                                                        <span class="text-xs px-1 py-0.5 rounded ${pos.side === "Buy" ? "bg-green-600 text-green-100" : "bg-red-600 text-red-100"}">
                                                            ${pos.side}
                                                        </span>
                                                    </td>
                                                    <td class="p-1.5 text-right font-medium ${pos.unrealizedPnl >= 0 ? "text-green-400" : "text-red-400"}">
                                                        <span class="whitespace-nowrap">${fmt(pos.unrealizedPnl)} USDT</span><br>
                                                        <span class="text-xs px-1 py-0.5 rounded whitespace-nowrap ${pos.unrealizedPnl >= 0 ? "bg-green-600 text-green-100" : "bg-red-600 text-red-100"}">
                                                            ${fmt(pos.percentage)}%
                                                        </span>
                                                    </td>
                                                    <td class="p-1.5 text-right text-gray-300"><span class="whitespace-nowrap">${fmt(pos.positionValue)} USDT</span></td>
                                                    <td class="p-1.5 text-right text-gray-300"><span class="whitespace-nowrap">${fmt(pos.size, 2, 6) + " " + pos.symbol.replace("USDT", "")}</span><br><span class="whitespace-nowrap">${fmt(pos.entryPrice, 6, 6)} USDT</span></td>
                                                </tr>
                                            `,
                                              )
                                              .join("")}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

        // Positions tablosu için sort (value, pnl, percentage)
        const positionsTbody = modal.querySelector(".positions-tbody");
        const sortSpans = modal.querySelectorAll(".positions-sort");
        let positionsSortState = { key: "pnl", order: -1 };

        function positionRowHtml(pos) {
          return `
                                                <tr class="hover:bg-gray-600">
                                                    <td class="p-1.5 text-white font-medium text-xs">${pos.symbol} </br>
                                                        <span class="text-xs px-1 py-0.5 rounded ${pos.side === "Buy" ? "bg-green-600 text-green-100" : "bg-red-600 text-red-100"}">
                                                            ${pos.side}
                                                        </span></td>
                                                    <td class="p-1.5 text-right text-gray-300"><span class="whitespace-nowrap">${fmt(pos.size, 2, 6) + " " + pos.symbol.replace("USDT", "")}</span><br><span class="whitespace-nowrap">${fmt(pos.entryPrice, 6, 6)} USDT</span></td>
                                                    <td class="p-1.5 text-right text-gray-300"><span class="whitespace-nowrap">${fmt(pos.positionValue)} USDT</span></td>
                                                    <td class="p-1.5 text-right font-medium ${pos.unrealizedPnl >= 0 ? "text-green-400" : "text-red-400"}">
                                                        <span class="whitespace-nowrap">${fmt(pos.unrealizedPnl)} USDT</span><br>
                                                        <span class="text-xs px-1 py-0.5 rounded whitespace-nowrap ${pos.unrealizedPnl >= 0 ? "bg-green-600 text-green-100" : "bg-red-600 text-red-100"}">
                                                            ${fmt(pos.percentage)}%
                                                        </span>
                                                    </td>
                                                </tr>`;
        }

        function renderPositionsBody(sortedPositions) {
          return sortedPositions.map(positionRowHtml).join("");
        }

        sortSpans.forEach((span) => {
          span.addEventListener("click", () => {
            const key = span.dataset.sort;
            if (positionsSortState.key === key) positionsSortState.order *= -1;
            else {
              positionsSortState.key = key;
              positionsSortState.order = -1;
            }
            const sorted = [...positions].sort((a, b) => {
              let va, vb;
              if (key === "value") {
                va = a.positionValue;
                vb = b.positionValue;
              } else if (key === "pnl") {
                va = a.unrealizedPnl;
                vb = b.unrealizedPnl;
              } else {
                va = a.percentage;
                vb = b.percentage;
              }
              return (vb - va) * positionsSortState.order;
            });
            positionsTbody.innerHTML = renderPositionsBody(sorted);
          });
        });

        return modal;
      }

      // Position History modal = Kapatılmış pozisyonlar (sayfalı)
      function createPositionHistoryModal(
        data,
        page = 1,
        pageSize = POSITIONS_PAGE_SIZE,
      ) {
        const rawList = Array.isArray(data)
          ? data
          : data?.positions || data?.items || data?.list || data?.data || [];
        const total =
          typeof data === "object" && !Array.isArray(data) && data.total != null
            ? data.total
            : rawList.length;
        const list = Array.isArray(rawList) ? rawList : [];
        const fmt = (n, minF = 2, maxF = 2) =>
          Number(n).toLocaleString("tr-TR", {
            minimumFractionDigits: minF,
            maximumFractionDigits: maxF,
          });
        const totalPages = Math.max(1, Math.ceil(total / pageSize));

        function rowHtml(pos) {
          const symbol = pos.symbol || pos.symbolName || "-";
          const side = pos.side || "-";
          const size =
            pos.size != null
              ? fmt(pos.size, 2, 6) + " " + (symbol + "").replace("USDT", "")
              : "-";
          const entry =
            pos.entryPrice != null ? fmt(pos.entryPrice, 2, 6) + " USDT" : "-";
          const exitVal =
            pos.exitPrice != null || pos.avgPrice != null
              ? fmt(pos.exitPrice ?? pos.avgPrice, 2, 6) + " USDT"
              : "-";
          const pnl =
            pos.realizedPnl != null
              ? pos.realizedPnl
              : pos.pnl != null
                ? pos.pnl
                : null;
          const pnlStr =
            pnl != null ? (pnl >= 0 ? "+" : "") + fmt(pnl) + " USDT" : "-";
          const pnlClass =
            pnl != null
              ? pnl >= 0
                ? "text-green-400"
                : "text-red-400"
              : "text-gray-400";
          const date =
            pos.closedTime != null
              ? new Date(pos.closedTime).toLocaleString("tr-TR")
              : pos.updatedTime != null
                ? new Date(pos.updatedTime).toLocaleString("tr-TR")
                : "-";
          return `
                <tr class="hover:bg-gray-600">
                    <td class="p-1.5 text-white font-medium text-xs">${symbol}<br>
                        <span class="text-xs px-1 py-0.5 rounded ${side === "Buy" ? "bg-green-600 text-green-100" : "bg-red-600 text-red-100"}">${side}</span>
                    </td>
                    <td class="p-1.5 text-right text-gray-300 whitespace-nowrap">${size}</td>
                    <td class="p-1.5 text-right text-gray-300 whitespace-nowrap">${entry}</td>
                    <td class="p-1.5 text-right text-gray-300 whitespace-nowrap">${exitVal}</td>
                    <td class="p-1.5 text-right font-medium whitespace-nowrap ${pnlClass}">${pnlStr}</td>
                    <td class="p-1.5 text-right text-gray-400 text-xs whitespace-nowrap">${date}</td>
                </tr>`;
        }

        function bodyHtml(positions, currentPage, totalCount, size, totalPgs) {
          const paginationHtml =
            totalPgs > 1
              ? `
                    <div class="flex flex-wrap items-center justify-between gap-2 mt-3 text-sm text-gray-400">
                        <span>Sayfa ${currentPage} / ${totalPgs} (toplam ${totalCount} kapatılmış pozisyon)</span>
                        <div class="flex gap-2">
                            <button type="button" data-action="positions-prev" class="px-3 py-1.5 rounded bg-gray-600 hover:bg-gray-500 text-white disabled:opacity-50 disabled:cursor-not-allowed" ${currentPage <= 1 ? "disabled" : ""}>Önceki</button>
                            <button type="button" data-action="positions-next" class="px-3 py-1.5 rounded bg-gray-600 hover:bg-gray-500 text-white disabled:opacity-50 disabled:cursor-not-allowed" ${currentPage >= totalPgs ? "disabled" : ""}>Sonraki</button>
                        </div>
                    </div>`
              : totalCount > 0
                ? `<p class="text-gray-400 text-sm mt-2">Toplam ${totalCount} kapatılmış pozisyon.</p>`
                : "";
          const tableHtml =
            positions.length === 0
              ? '<p class="text-gray-400 py-4">Bu sayfada kapatılmış pozisyon yok.</p>'
              : `
                    <div class="bg-gray-700 rounded-lg overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-600">
                                    <tr>
                                        <th class="text-left p-3 text-gray-300">Symbol</th>
                                        <th class="text-right p-3 text-gray-300">Size</th>
                                        <th class="text-right p-3 text-gray-300">Entry</th>
                                        <th class="text-right p-3 text-gray-300">Exit</th>
                                        <th class="text-right p-3 text-gray-300">PnL</th>
                                        <th class="text-right p-3 text-gray-300">Tarih</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-600 font-mono">${positions.map(rowHtml).join("")}</tbody>
                            </table>
                        </div>
                    </div>`;
          return `<h3 class="text-sm font-medium text-gray-400 uppercase mb-2">Kapatılmış Pozisyonlar (sayfa ${currentPage})</h3>${tableHtml}${paginationHtml}`;
        }

        const modal = document.createElement("div");
        modal.className =
          "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 opacity-0 transition-opacity duration-300 modal-position-history";
        modal.style.paddingTop = "max(5rem, env(safe-area-inset-top))";
        modal.style.paddingBottom = "max(1rem, env(safe-area-inset-bottom))";
        modal.style.paddingLeft = "max(1rem, env(safe-area-inset-left))";
        modal.style.paddingRight = "max(1rem, env(safe-area-inset-right))";

        modal.innerHTML = `
                <div class="modal-content bg-gray-800 rounded-lg w-full h-full overflow-hidden transform scale-95 transition-transform duration-300">
                    <div class="bg-gray-900 p-4 border-b border-gray-700 flex items-center justify-between">
                        <h2 class="text-lg font-semibold text-white">Position History</h2>
                        <button onclick="closeModal(this)" class="text-gray-400 hover:text-white">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="overflow-y-auto h-full p-4" id="position-history-body">${bodyHtml(list, page, total, pageSize, totalPages)}</div>
                </div>
            `;

        modal.dataset.currentPage = String(page);
        modal.dataset.total = String(total);
        modal.dataset.pageSize = String(pageSize);

        const bodyEl = modal.querySelector("#position-history-body");
        const updateBody = (positions, currentPage, totalCount) => {
          modal.dataset.total = String(totalCount);
          bodyEl.innerHTML = bodyHtml(
            positions,
            currentPage,
            totalCount,
            pageSize,
            Math.max(1, Math.ceil(totalCount / pageSize)),
          );
          modal.dataset.currentPage = String(currentPage);
          bindPaginationListeners();
        };

        function bindPaginationListeners() {
          const prevBtn = modal.querySelector('[data-action="positions-prev"]');
          const nextBtn = modal.querySelector('[data-action="positions-next"]');
          if (prevBtn) prevBtn.onclick = null;
          if (nextBtn) nextBtn.onclick = null;
          prevBtn?.addEventListener("click", async () => {
            const p = parseInt(modal.dataset.currentPage, 10) || 1;
            if (p <= 1) return;
            try {
              const res = await fetch(
                POSITIONS_CLOSED_API +
                  "?page=" +
                  (p - 1) +
                  "&limit=" +
                  pageSize,
              );
              const json = await res.json();
              if (json.success && json.data) {
                const d = json.data;
                const arr = Array.isArray(d)
                  ? d
                  : d.positions || d.items || d.list || [];
                const tot = d && d.total != null ? d.total : arr.length;
                updateBody(arr, p - 1, tot);
              }
            } catch (e) {
              console.error(e);
            }
          });
          nextBtn?.addEventListener("click", async () => {
            const p = parseInt(modal.dataset.currentPage, 10) || 1;
            const tot = parseInt(modal.dataset.total, 10) || 0;
            const totalPgs = Math.ceil(tot / pageSize);
            if (p >= totalPgs) return;
            try {
              const res = await fetch(
                POSITIONS_CLOSED_API +
                  "?page=" +
                  (p + 1) +
                  "&limit=" +
                  pageSize,
              );
              const json = await res.json();
              if (json.success && json.data) {
                const d = json.data;
                const arr = Array.isArray(d)
                  ? d
                  : d.positions || d.items || d.list || [];
                const totalCount = d && d.total != null ? d.total : arr.length;
                updateBody(arr, p + 1, totalCount);
              }
            } catch (e) {
              console.error(e);
            }
          });
        }
        bindPaginationListeners();

        modal.addEventListener("click", (e) => {
          if (e.target === modal) closeModal(modal.querySelector("button"));
        });

        return modal;
      }

      // Main Account modal oluştur
      function createMainAccountModal(data) {
        const summary = data.summary;
        const coinDetails = data.coinDetails;

        const modal = document.createElement("div");
        modal.className =
          "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 opacity-0 transition-opacity duration-300";
        modal.style.paddingTop = "max(5rem, env(safe-area-inset-top))";
        modal.style.paddingBottom = "max(1rem, env(safe-area-inset-bottom))";
        modal.style.paddingLeft = "max(1rem, env(safe-area-inset-left))";
        modal.style.paddingRight = "max(1rem, env(safe-area-inset-right))";

        modal.innerHTML = `
                <div class="modal-content bg-gray-800 rounded-lg w-full h-full overflow-hidden transform scale-95 transition-transform duration-300">
                    <!-- Header -->
                    <div class="bg-gray-900 p-4 border-b border-gray-700 flex items-center justify-between">
                        <h2 class="text-lg font-semibold text-white">Main Account Summary</h2>
                        <button onclick="closeModal(this)" class="text-gray-400 hover:text-white">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Content -->
                    <div class="overflow-y-auto h-full">
                        <!-- Account Type -->
                        <div class="p-4 border-b border-gray-700">
                            <h3 class="text-sm font-medium text-gray-400 uppercase mb-2">Account Type</h3>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-white font-medium">${summary.accountType}</p>
                            </div>
                        </div>

                        <!-- Summary Cards -->
                        <div class="p-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">Total Equity</p>
                                <p class="text-lg font-semibold text-white">$${summary.totalEquity.toLocaleString()}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">Available Balance</p>
                                <p class="text-lg font-semibold text-white">$${summary.availableBalance.toLocaleString()}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">Margin Balance</p>
                                <p class="text-lg font-semibold text-white">$${summary.marginBalance.toLocaleString()}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">Unrealized PnL</p>
                                <p class="text-lg font-semibold ${summary.unrealizedPnL >= 0 ? "text-green-400" : "text-red-400"}">
                                    $${summary.unrealizedPnL.toLocaleString()}
                                </p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">MM Equity Ratio</p>
                                <p class="text-lg font-semibold text-white">${summary.mmEquityRatio.toFixed(4)}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">IM Equity Ratio</p>
                                <p class="text-lg font-semibold text-white">${summary.imEquityRatio.toFixed(4)}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">Maintenance Margin</p>
                                <p class="text-lg font-semibold text-white">$${summary.maintenanceMargin.toLocaleString()}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">Initial Margin</p>
                                <p class="text-lg font-semibold text-white">$${summary.initialMargin.toLocaleString()}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3">
                                <p class="text-xs text-gray-400 uppercase">Open Positions</p>
                                <p class="text-lg font-semibold text-white">${summary.openPositionsCount}</p>
                            </div>
                        </div>

                        <!-- Coin Details -->
                        <div class="px-4 pb-4">
                            <h3 class="text-sm font-medium text-gray-400 uppercase mb-2">Coin Details (${coinDetails.length})</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                ${coinDetails
                                  .map(
                                    (coin) => `
                                    <div class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                                        <!-- Coin Header -->
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center space-x-2">
                                                <div class="w-8 h-8 bg-yellow-600 rounded-full flex items-center justify-center">
                                                    <span class="text-xs font-bold text-white">${coin.coin}</span>
                                                </div>
                                                <h4 class="font-semibold text-white">${coin.coin}</h4>
                                            </div>
                                            <span class="text-xs px-2 py-1 rounded bg-blue-600 text-blue-100">${coin.accountType}</span>
                                        </div>

                                        <!-- Coin Details -->
                                        <div class="space-y-3">
                                            <div class="flex justify-between items-center">
                                                <span class="text-xs text-gray-400 uppercase">Wallet Balance</span>
                                                <span class="text-sm font-medium text-white">${coin.walletBalance.toLocaleString()}</span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-xs text-gray-400 uppercase">Equity</span>
                                                <span class="text-sm font-medium text-white">${coin.equity.toLocaleString()}</span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-xs text-gray-400 uppercase">Unrealized PnL</span>
                                                <span class="text-sm font-medium ${coin.unrealizedPnl >= 0 ? "text-green-400" : "text-red-400"}">
                                                    ${coin.unrealizedPnl >= 0 ? "+" : ""}${coin.unrealizedPnl.toLocaleString()}
                                                </span>
                                            </div>
                                        </div>

                                        <!-- Account Type Detail -->
                                        <div class="mt-3 pt-3 border-t border-gray-600">
                                            <span class="text-xs text-gray-500">${coin.accountType}</span>
                                        </div>
                                    </div>
                                `,
                                  )
                                  .join("")}
                            </div>
                        </div>

                        <!-- Positions Info -->
                        ${
                          data.positions.length === 0
                            ? `
                            <div class="px-4 pb-4">
                                <h3 class="text-sm font-medium text-gray-400 uppercase mb-2">Positions</h3>
                                <div class="bg-gray-700 rounded-lg p-4 text-center">
                                    <p class="text-gray-400">No open positions</p>
                                </div>
                            </div>
                        `
                            : ""
                        }
                    </div>
                </div>
            `;

        return modal;
      }

      // Main Account Earning modal oluştur
      function createMainAccountEarningModal(data) {
        const summary = data.summary;
        const positions = data.positions;

        const modal = document.createElement("div");
        modal.className =
          "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 opacity-0 transition-opacity duration-300";
        modal.style.paddingTop = "max(5rem, env(safe-area-inset-top))";
        modal.style.paddingBottom = "max(1rem, env(safe-area-inset-bottom))";
        modal.style.paddingLeft = "max(1rem, env(safe-area-inset-left))";
        modal.style.paddingRight = "max(1rem, env(safe-area-inset-right))";

        modal.innerHTML = `
                <div class="modal-content bg-gray-800 rounded-lg w-full h-full overflow-hidden transform scale-95 transition-transform duration-300">
                    <!-- Header -->
                    <div class="bg-gray-900 p-4 border-b border-gray-700 flex items-center justify-between">
                        <h2 class="text-lg font-semibold text-white">Main Account Earnings</h2>
                        <button onclick="closeModal(this)" class="text-gray-400 hover:text-white">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Content -->
                    <div class="overflow-y-auto h-full">
                        <!-- Summary Cards -->
                        <div class="p-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-gray-700 rounded-lg p-4">
                                <p class="text-xs text-gray-400 uppercase">Total Earnings</p>
                                <p class="text-2xl font-bold text-green-400">$${summary.totalEarnings.toLocaleString()}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-4">
                                <p class="text-xs text-gray-400 uppercase">Total Staked</p>
                                <p class="text-2xl font-bold text-white">$${summary.totalStaked.toLocaleString()}</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-4">
                                <p class="text-xs text-gray-400 uppercase">Positions Count</p>
                                <p class="text-2xl font-bold text-white">${summary.positionsCount}</p>
                            </div>
                        </div>

                        <!-- APY Calculation -->
                        <div class="px-4 pb-4">
                            <div class="bg-gray-700 rounded-lg p-4">
                                <p class="text-xs text-gray-400 uppercase mb-2">Estimated APY</p>
                                <p class="text-xl font-semibold text-blue-400">
                                    ${((summary.totalEarnings / summary.totalStaked) * 100).toFixed(4)}%
                                </p>
                                <p class="text-xs text-gray-500 mt-1">Based on current earnings vs staked amount</p>
                            </div>
                        </div>

                        <!-- Earning Positions -->
                        <div class="px-4 pb-4">
                            <h3 class="text-sm font-medium text-gray-400 uppercase mb-2">Earning Positions (${positions.length})</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                ${positions
                                  .map(
                                    (pos) => `
                                    <div class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                                        <!-- Position Header -->
                                        <div class="flex items-center justify-between mb-4">
                                            <div class="flex items-center space-x-3">
                                                <div class="w-10 h-10 bg-yellow-600 rounded-full flex items-center justify-center">
                                                    <span class="text-sm font-bold text-white">${pos.coin}</span>
                                                </div>
                                                <div>
                                                    <h4 class="font-semibold text-white">${pos.coin}</h4>
                                                    <p class="text-xs text-gray-400">${pos.currency}</p>
                                                </div>
                                            </div>
                                            <div class="flex flex-col items-end space-y-1">
                                                <span class="text-xs px-2 py-1 rounded bg-gray-600 text-gray-300">ID: ${pos.productId}</span>
                                                ${pos.status ? `<span class="text-xs px-2 py-1 rounded bg-blue-600 text-blue-100">${pos.status}</span>` : '<span class="text-xs px-2 py-1 rounded bg-green-600 text-green-100">Active</span>'}
                                            </div>
                                        </div>

                                        <!-- Amount Section -->
                                        <div class="mb-4 p-3 bg-gray-600 rounded-lg">
                                            <p class="text-xs text-gray-400 uppercase mb-1">Staked Amount</p>
                                            <p class="text-xl font-bold text-white">${pos.amount.toLocaleString()} ${pos.currency}</p>
                                        </div>

                                        <!-- Earnings Grid -->
                                        <div class="grid grid-cols-3 gap-3">
                                            <div class="text-center">
                                                <p class="text-xs text-gray-400 uppercase mb-1">Total PnL</p>
                                                <p class="text-sm font-semibold ${pos.totalPnl >= 0 ? "text-green-400" : "text-red-400"}">
                                                    ${pos.totalPnl >= 0 ? "+" : ""}$${pos.totalPnl.toLocaleString()}
                                                </p>
                                            </div>
                                            <div class="text-center">
                                                <p class="text-xs text-gray-400 uppercase mb-1">Claimable</p>
                                                <p class="text-sm font-semibold text-yellow-400">
                                                    $${pos.claimableYield.toLocaleString()}
                                                </p>
                                            </div>
                                            <div class="text-center">
                                                <p class="text-xs text-gray-400 uppercase mb-1">Total Earning</p>
                                                <p class="text-sm font-semibold text-green-400">
                                                    $${pos.earning.toLocaleString()}
                                                </p>
                                            </div>
                                        </div>

                                        <!-- Yield Percentage -->
                                        <div class="mt-4 pt-3 border-t border-gray-600">
                                            <div class="flex justify-between items-center">
                                                <span class="text-xs text-gray-400 uppercase">Yield Rate</span>
                                                <span class="text-sm font-medium text-blue-400">
                                                    ${((pos.earning / pos.amount) * 100).toFixed(4)}%
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                `,
                                  )
                                  .join("")}
                            </div>
                        </div>

                        <!-- Earnings Breakdown -->
                        <div class="px-4 pb-4">
                            <h3 class="text-sm font-medium text-gray-400 uppercase mb-2">Earnings Breakdown</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-gray-700 rounded-lg p-3">
                                    <p class="text-xs text-gray-400 uppercase">Total PnL</p>
                                    <p class="text-lg font-semibold ${positions.reduce((sum, pos) => sum + pos.totalPnl, 0) >= 0 ? "text-green-400" : "text-red-400"}">
                                        $${positions.reduce((sum, pos) => sum + pos.totalPnl, 0).toLocaleString()}
                                    </p>
                                </div>
                                <div class="bg-gray-700 rounded-lg p-3">
                                    <p class="text-xs text-gray-400 uppercase">Claimable Yield</p>
                                    <p class="text-lg font-semibold text-yellow-400">
                                        $${positions.reduce((sum, pos) => sum + pos.claimableYield, 0).toLocaleString()}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

        return modal;
      }

      // Modal kapat
      function closeModal(button) {
        const modal = button.closest(".fixed");
        modal.classList.add("opacity-0");
        modal.querySelector(".modal-content").classList.remove("scale-100");
        modal.querySelector(".modal-content").classList.add("scale-95");

        setTimeout(() => {
          modal.remove();
        }, 300);
      }

      // Modal dışına tıklayınca kapat
      document.addEventListener("click", (e) => {
        if (
          e.target.classList.contains("fixed") &&
          e.target.classList.contains("bg-black")
        ) {
          closeModal(e.target.querySelector("button"));
        }
      });
    </script>
    <!-- Header -->
    <div class="bg-gray-900 header-safe">
      <div class="flex items-center justify-center py-6">
        <h1 class="text-xl font-semibold text-white">Bot Ayarları</h1>
      </div>
    </div>

    <!-- Settings Content -->
    <div class="content-safe space-y-6">
      <!-- Account Actions -->
      <div class="bg-gray-800 rounded-lg shadow-sm border border-gray-700">
        <div class="p-4 border-b border-gray-700">
          <h2 class="text-sm font-medium text-gray-400 uppercase tracking-wide">
            Hesap İşlemleri
          </h2>
        </div>

        <!-- Subaccount Summary -->
        <div class="border-b border-gray-700 last:border-b-0">
          <button
            data-action="subaccount-summary"
            class="w-full p-4 flex items-center justify-between hover:bg-gray-700 active:bg-gray-600 transition-colors"
          >
            <div class="flex items-center space-x-3">
              <div
                class="w-8 h-8 bg-blue-900 rounded-lg flex items-center justify-center"
              >
                <svg
                  class="w-4 h-4 text-blue-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
                  ></path>
                </svg>
              </div>
              <div class="text-left">
                <h3 class="font-medium text-white">Subaccount Summary</h3>
                <p class="text-sm text-gray-400">Alt hesap özeti</p>
              </div>
            </div>
            <svg
              class="w-5 h-5 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              ></path>
            </svg>
          </button>
        </div>

        <!-- Subaccount Stats -->
        <div class="border-b border-gray-700 last:border-b-0">
          <button
            data-action="subaccount-stats"
            class="w-full p-4 flex items-center justify-between hover:bg-gray-700 active:bg-gray-600 transition-colors"
          >
            <div class="flex items-center space-x-3">
              <div
                class="w-8 h-8 bg-indigo-900 rounded-lg flex items-center justify-center"
              >
                <svg
                  class="w-4 h-4 text-indigo-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
                  ></path>
                </svg>
              </div>
              <div class="text-left">
                <h3 class="font-medium text-white">Subaccount Stats</h3>
                <p class="text-sm text-gray-400">Özet geçmişi (snapshots)</p>
              </div>
            </div>
            <svg
              class="w-5 h-5 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              ></path>
            </svg>
          </button>
        </div>

        <!-- Position History 
            <div class="border-b border-gray-700 last:border-b-0">
                <button data-action="position-history" class="w-full p-4 flex items-center justify-between hover:bg-gray-700 active:bg-gray-600 transition-colors">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-amber-900 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="text-left">
                            <h3 class="font-medium text-white">Position History</h3>
                            <p class="text-sm text-gray-400">Pozisyon geçmişi</p>
                        </div>
                    </div>
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>
            </div> -->

        <!-- Main Account Summary -->
        <div class="border-b border-gray-700 last:border-b-0">
          <button
            data-action="main-account-summary"
            class="w-full p-4 flex items-center justify-between hover:bg-gray-700 active:bg-gray-600 transition-colors"
          >
            <div class="flex items-center space-x-3">
              <div
                class="w-8 h-8 bg-green-900 rounded-lg flex items-center justify-center"
              >
                <svg
                  class="w-4 h-4 text-green-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2v0a2 2 0 002-2h14a2 2 0 012 2v0"
                  ></path>
                </svg>
              </div>
              <div class="text-left">
                <h3 class="font-medium text-white">Main Account Summary</h3>
                <p class="text-sm text-gray-400">Ana hesap özeti</p>
              </div>
            </div>
            <svg
              class="w-5 h-5 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              ></path>
            </svg>
          </button>
        </div>

        <!-- Main Account Earning -->
        <div class="border-b border-gray-700 last:border-b-0">
          <button
            data-action="main-account-earning"
            class="w-full p-4 flex items-center justify-between hover:bg-gray-700 active:bg-gray-600 transition-colors"
          >
            <div class="flex items-center space-x-3">
              <div
                class="w-8 h-8 bg-purple-900 rounded-lg flex items-center justify-center"
              >
                <svg
                  class="w-4 h-4 text-purple-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"
                  ></path>
                </svg>
              </div>
              <div class="text-left">
                <h3 class="font-medium text-white">Main Account Earning</h3>
                <p class="text-sm text-gray-400">Ana hesap kazançları</p>
              </div>
            </div>
            <svg
              class="w-5 h-5 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              ></path>
            </svg>
          </button>
        </div>
      </div>
      <!-- Position Value Threshold Form -->
      <div class="bg-gray-800 rounded-lg shadow-sm border border-gray-700">
        <div
          class="p-4 border-b border-gray-700 flex items-center justify-between"
        >
          <h2 class="text-sm font-medium text-gray-400 uppercase tracking-wide">
            Alarm Ayarları
          </h2>
          <!-- Status Indicator -->
          <div class="flex flex-col items-end space-y-1">
            <div class="flex items-center space-x-2">
              <div
                id="statusIndicator"
                class="w-3 h-3 rounded-full bg-gray-500 transition-all duration-300"
              ></div>
              <span id="statusText" class="text-xs text-gray-400"
                >Bekleniyor...</span
              >
            </div>
            <div id="uptimeText" class="text-xs text-gray-500">--:--:--:--</div>
          </div>
        </div>

        <div class="p-4">
          <form class="space-y-4">
            <div>
              <label
                for="positionThreshold"
                class="block text-sm font-medium text-gray-300 mb-2"
              >
                Position Value Threshold
              </label>
              <div class="relative">
                <input
                  type="number"
                  id="positionThreshold"
                  name="positionThreshold"
                  placeholder="0.00"
                  step="0.01"
                  min="0"
                  class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl text-lg font-medium text-white placeholder-gray-400 focus:bg-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all duration-200 appearance-none"
                  style="-webkit-appearance: none; -moz-appearance: textfield"
                />
                <div
                  class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none"
                >
                  <span class="text-gray-400 font-medium">USDT</span>
                </div>
              </div>
              <p class="mt-2 text-sm text-gray-400">
                Minimum pozisyon değeri eşiği belirleyiniz
              </p>
            </div>

            <div>
              <label
                for="imThreshold"
                class="block text-sm font-medium text-gray-300 mb-2"
              >
                IM Threshold
              </label>
              <div class="relative">
                <input
                  type="number"
                  id="imThreshold"
                  name="imThreshold"
                  placeholder="0.00"
                  step="0.01"
                  min="0"
                  class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl text-lg font-medium text-white placeholder-gray-400 focus:bg-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all duration-200 appearance-none"
                  style="-webkit-appearance: none; -moz-appearance: textfield"
                />
                <div
                  class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none"
                >
                  <span class="text-gray-400 font-medium">USDT</span>
                </div>
              </div>
              <p class="mt-2 text-sm text-gray-400">
                Initial Margin eşik değerini belirleyiniz
              </p>
            </div>

            <div>
              <label
                for="interval"
                class="block text-sm font-medium text-gray-300 mb-2"
              >
                Interval
              </label>
              <div class="relative">
                <input
                  type="number"
                  id="interval"
                  name="interval"
                  placeholder="60000"
                  step="1"
                  min="1"
                  class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-xl text-lg font-medium text-white placeholder-gray-400 focus:bg-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all duration-200 appearance-none"
                  style="-webkit-appearance: none; -moz-appearance: textfield"
                />
                <div
                  class="absolute inset-y-0 right-0 flex items-center pr-4 pointer-events-none"
                >
                  <span class="text-gray-400 font-medium">ms</span>
                </div>
              </div>
              <p class="mt-2 text-sm text-gray-400">
                Alarm kontrol aralığını belirleyiniz
                <span class="text-orange-400">(min 60000ms)</span>
              </p>
            </div>

            <button
              type="submit"
              class="w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-xl hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all duration-200 active:scale-[0.98]"
              id="saveButton"
            >
              Kaydet
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Bottom spacing -->
    <div class="h-32"></div>
  </body>
</html>
